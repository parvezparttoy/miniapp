<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Quick Capture</title>
<style>
  :root{--bg1:#0b1120;--bg2:#0a1228;--accent:#00e5ff;--text:#eaf2ff;--muted:#9fb6da}
  *{box-sizing:border-box}
  html,body{height:100%} body{
    margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;color:var(--text);
    background:radial-gradient(900px 600px at 20% -10%, rgba(0,229,255,.08), transparent 60%),
               linear-gradient(180deg,var(--bg1),var(--bg2));
  }

  /* Top bar */
  .top{position:sticky;top:0;z-index:9;display:flex;align-items:center;gap:8px;
       padding:12px 14px;background:rgba(7,13,25,.6);backdrop-filter:blur(6px);
       border-bottom:1px solid rgba(255,255,255,.05)}
  .brand{font-weight:900;letter-spacing:.3px;color:var(--accent)}
  .menu{margin-left:auto;position:relative}
  .icon{background:transparent;border:0;color:var(--text);font-size:22px;cursor:pointer;padding:6px;border-radius:8px}
  .dd{position:absolute;right:0;top:36px;background:#071427;border:1px solid rgba(255,255,255,.05);
      border-radius:10px;display:none;min-width:160px;box-shadow:0 10px 30px rgba(0,0,0,.5)}
  .dd.show{display:block}
  .ddi{padding:10px 12px;cursor:pointer;border-radius:8px}
  .ddi:hover{background:rgba(255,255,255,.05)}

  /* Main */
  .wrap{max-width:900px;margin:0 auto;padding:22px 14px}
  .card{background:rgba(12,18,36,.65);border:1px solid rgba(255,255,255,.06);border-radius:14px;padding:16px;
        box-shadow:0 16px 40px rgba(0,0,0,.45)}
  .center{text-align:center}
  .title{font-size:22px;font-weight:900;margin:0 0 6px}
  .muted{color:var(--muted);font-size:13px}
  .btn{display:inline-block;background:var(--accent);border:0;color:#02131b;font-weight:900;
       padding:12px 16px;border-radius:12px;cursor:pointer}
  .btn.ghost{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,.08)}
  .hide{display:none}

  /* Admin */
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px}
  .p{background:rgba(8,12,20,.6);border:1px solid rgba(255,255,255,.05);border-radius:10px;padding:8px}
  .p img{width:100%;height:auto;border-radius:8px}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  .sbtn{padding:6px 8px;border-radius:8px;border:0;cursor:pointer;font-weight:800}
  .dl{background:linear-gradient(90deg,#0ea5e9,#22d3ee);color:#002}
  .del{background:linear-gradient(90deg,#f43f5e,#fb7185);color:#200}
  .footer{margin-top:24px;text-align:center;color:var(--muted);font-size:12px}

  /* Simple modal */
  .mbg{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:20}
  .mbg.show{display:flex}
  .modal{background:#071427;border:1px solid rgba(255,255,255,.06);border-radius:12px;max-width:720px;width:92%;padding:16px}
  .input{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.08);background:transparent;color:var(--text)}
</style>
</head>
<body>

<!-- Top -->
<div class="top">
  <div class="brand">Quick Capture</div>
  <div class="menu">
    <button id="menuBtn" class="icon" aria-label="Menu">⋯</button>
    <div id="menu" class="dd" role="menu">
      <div class="ddi" id="about">About us</div>
      <div class="ddi" id="faq">FAQ</div>
      <div class="ddi" id="login">Login</div>
    </div>
  </div>
</div>

<div class="wrap">

  <!-- Home: only one button -->
  <section id="home" class="card center">
    <h1 class="title">Get Started</h1>
    <p class="muted">Tap the button below. We’ll ask for camera permission and automatically take a front & back photo, then save to Admin storage.</p>
    <button id="start" class="btn">Get Start</button>
  </section>

  <!-- Admin Panel (protected) -->
  <section id="admin" class="card hide">
    <div class="row" style="justify-content:space-between;align-items:center">
      <h2 class="title" style="margin:0">Admin Panel — Saved Photos</h2>
      <div class="row">
        <button id="export" class="btn ghost">Export JSON</button>
        <button id="clear" class="btn ghost">Delete All</button>
      </div>
    </div>
    <div id="grid" class="grid" style="margin-top:12px"></div>
  </section>

  <div class="footer">Client-side demo · Photos are stored in this browser’s localStorage</div>
</div>

<!-- Modal -->
<div id="mbg" class="mbg" role="dialog" aria-hidden="true">
  <div class="modal">
    <div id="mcontent"></div>
    <div style="margin-top:12px;text-align:right">
      <button id="mclose" class="btn ghost">Close</button>
    </div>
  </div>
</div>

<script>
(() => {
  // --- Elements
  const menuBtn = document.getElementById('menuBtn');
  const menu    = document.getElementById('menu');
  const about   = document.getElementById('about');
  const faq     = document.getElementById('faq');
  const login   = document.getElementById('login');
  const start   = document.getElementById('start');
  const homeSec = document.getElementById('home');
  const adminSec= document.getElementById('admin');
  const grid    = document.getElementById('grid');
  const exportBtn = document.getElementById('export');
  const clearBtn  = document.getElementById('clear');

  const mbg  = document.getElementById('mbg');
  const mcon = document.getElementById('mcontent');
  const mclose = document.getElementById('mclose');

  // --- Dropdown
  menuBtn.onclick = () => menu.classList.toggle('show');
  window.addEventListener('click', e => {
    if (!menu.contains(e.target) && e.target !== menuBtn) menu.classList.remove('show');
  });

  // --- Modal helpers
  function openModal(html){ mcon.innerHTML = html; mbg.classList.add('show'); }
  function closeModal(){ mbg.classList.remove('show'); }
  mclose.onclick = closeModal; mbg.addEventListener('click', e=>{ if(e.target===mbg) closeModal(); });

  // About / FAQ (তুমি চাইলে টেক্সট পাল্টে দিও)
  about.onclick = () => { menu.classList.remove('show'); openModal(`<h3>About us</h3><p class="muted">This is a minimal client-side demo. Press “Get Start” to auto-capture front & back photos and save them locally. Admin login required to view photos.</p>`); };
  faq.onclick   = () => { menu.classList.remove('show'); openModal(`<h3>FAQ</h3><p class="muted"><b>Photos কোথায় সেভ হয়?</b> আপনার ব্রাউজারের localStorage-এ।</p><p class="muted"><b>অন্য সার্ভারে যায়?</b> না — এই ডেমোতে যায় না।</p>`); };

  // --- Login (password → open admin panel)
  const ADMIN_PASS = 'parvezparttoyhack';
  login.onclick = () => {
    menu.classList.remove('show');
    openModal(`
      <h3>Admin Login</h3>
      <input id="pwd" class="input" type="password" placeholder="Enter password">
      <div style="margin-top:10px;text-align:right"><button id="go" class="btn">Next</button></div>
    `);
    document.getElementById('go').onclick = () => {
      const v = (document.getElementById('pwd').value||'').trim();
      if (v === ADMIN_PASS) { closeModal(); openAdmin(); }
      else alert('Wrong password');
    };
  };

  // --- Storage helpers
  const KEY='qc_photos_v1';
  const load = () => { try{return JSON.parse(localStorage.getItem(KEY)||'[]');}catch{return []} };
  const save = (arr) => localStorage.setItem(KEY, JSON.stringify(arr));

  // --- Admin UI
  function openAdmin(){ homeSec.classList.add('hide'); adminSec.classList.remove('hide'); renderGrid(); }
  function renderGrid(){
    const items = load();
    grid.innerHTML = items.length ? '' : '<div class="card" style="grid-column:1/-1"><div class="muted">No photos saved yet.</div></div>';
    items.forEach(it=>{
      const el = document.createElement('div'); el.className='p';
      el.innerHTML = `
        <div class="muted" style="font-size:12px;margin-bottom:4px">${new Date(it.ts).toLocaleString()} · <b>${it.id}</b></div>
        <img src="${it.front}" alt="front">
        <div style="height:6px"></div>
        <img src="${it.back}" alt="back">
        <div class="row" style="margin-top:8px">
          <button class="sbtn dl" data-id="${it.id}">Download</button>
          <button class="sbtn del" data-id="${it.id}">Delete</button>
        </div>`;
      grid.appendChild(el);
    });
    grid.querySelectorAll('.dl').forEach(b=>{
      b.onclick = ()=>{
        const id=b.dataset.id, it=load().find(x=>x.id===id); if(!it) return;
        download(it.front, id+'-front.jpg'); download(it.back, id+'-back.jpg');
      };
    });
    grid.querySelectorAll('.del').forEach(b=>{
      b.onclick = ()=>{
        const id=b.dataset.id; let arr=load().filter(x=>x.id!==id); save(arr); renderGrid();
      };
    });
  }
  exportBtn.onclick = ()=>{
    const blob = new Blob([JSON.stringify(load(),null,2)],{type:'application/json'});
    const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='photos.json'; a.click(); URL.revokeObjectURL(url);
  };
  clearBtn.onclick = ()=>{ if(confirm('Delete ALL saved photos?')){ localStorage.removeItem(KEY); renderGrid(); } };

  function download(dataURI, file){ const a=document.createElement('a'); a.href=dataURI; a.download=file; document.body.appendChild(a); a.click(); a.remove(); }

  // --- Auto capture flow (no UI) after start
  start.onclick = async ()=>{
    start.disabled = true; start.textContent = 'Working…';
    try{
      const front = await autoShot('user');        // front
      const back  = await autoShot('environment'); // back
      const entry = { id: 'shot_'+Date.now(), front: await to64(front), back: await to64(back), ts: Date.now() };
      const arr = load(); arr.unshift(entry); save(arr);
      alert('Saved to Admin storage.');
    }catch(e){
      console.error(e); alert('Failed: camera permission or device error.');
    }finally{
      start.disabled = false; start.textContent = 'Get Start';
    }
  };

  // get one frame from a camera facingMode and stop stream
  async function autoShot(facing){
    // try exact environment first, fallback to facing string
    let constraints = { video: { facingMode: facing } };
    if (facing === 'environment') {
      try{ constraints = { video: { facingMode: { exact:'environment' } } }; } catch{}
    }
    const stream = await navigator.mediaDevices.getUserMedia(constraints);
    const trackSettings = stream.getVideoTracks()[0].getSettings?.() || {};
    const video = document.createElement('video');
    video.playsInline = true; video.muted = true; video.srcObject = stream;
    await video.play();
    // wait for dimensions
    await new Promise(r=>{
      if (video.readyState >= 2) r(); else video.onloadeddata = ()=>r();
      setTimeout(r, 800); // fallback
    });
    const w = video.videoWidth || trackSettings.width || 640;
    const h = video.videoHeight|| trackSettings.height|| 480;
    const canvas = document.createElement('canvas'); canvas.width=w; canvas.height=h;
    const ctx = canvas.getContext('2d'); ctx.drawImage(video,0,0,w,h);
    // stop stream
    stream.getTracks().forEach(t=>t.stop());
    return new Promise(res=> canvas.toBlob(res,'image/jpeg',0.9));
  }

  function to64(blob){
    return new Promise((res,rej)=>{
      const r=new FileReader(); r.onload=()=>res(r.result.toString()); r.onerror=rej; r.readAsDataURL(blob);
    });
  }
})();
</script>
</body>
</html>
