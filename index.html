<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Safe SMS Test Hub</title>
<style>
  body{font-family:system-ui,Arial;background:#f4f7fb;color:#04263b;padding:20px}
  .card{max-width:600px;margin:24px auto;padding:18px;border-radius:10px;background:#fff;box-shadow:0 6px 18px rgba(2,8,23,.08)}
  label{display:block;margin:8px 0 4px;font-weight:700}
  input,textarea,button{width:100%;padding:10px;border:1px solid #dbe7f0;border-radius:8px}
  button{background:#0b6cff;color:#fff;border:0;margin-top:10px;cursor:pointer}
  .hidden{display:none}
  .note{font-size:13px;color:#556b7a;margin-top:8px}
</style>
</head>
<body>
  <div class="card" id="authCard">
    <h2>Enter password</h2>
    <input id="pw" type="password" placeholder="password">
    <button id="pwBtn">Unlock</button>
    <p class="note">This page is for safe testing only. Use only your whitelisted numbers.</p>
  </div>

  <div class="card hidden" id="appCard">
    <h2>Safe SMS Test Hub (whitelist only)</h2>

    <label>Phone number (whitelist only):</label>
    <input id="phone" placeholder="+8801XXXXXXXXX">

    <label>Message (one SMS per request):</label>
    <textarea id="msg" rows="4" placeholder="Test message..."></textarea>

    <button id="sendBtn">Send (one SMS)</button>

    <p class="note">Only whitelisted numbers will receive SMS. Rate limits apply. Do not use for spamming.</p>

    <pre id="log" style="background:#eef6ff;padding:8px;border-radius:6px;max-height:180px;overflow:auto"></pre>
  </div>

<script>
  // CLIENT-SIDE PASSWORD (light protection). For strong security, do server-auth.
  const PASSWORD = 'parvezXnexo'; // keep secret — production: move to server
  const authCard = document.getElementById('authCard');
  const appCard  = document.getElementById('appCard');
  document.getElementById('pwBtn').addEventListener('click', ()=>{
    const val=document.getElementById('pw').value;
    if(val===PASSWORD){
      authCard.classList.add('hidden'); appCard.classList.remove('hidden');
    } else {
      alert('Wrong password');
    }
  });

  function log(txt){ const p=document.getElementById('log'); p.textContent = new Date().toLocaleTimeString() + ' — ' + txt + '\\n' + p.textContent; }

  document.getElementById('sendBtn').addEventListener('click', async ()=>{
    const phone = document.getElementById('phone').value.trim();
    const msg = document.getElementById('msg').value.trim();
    if(!phone || !msg){ alert('Enter phone and message'); return; }

    // call server endpoint
    try{
      log('Sending to ' + phone + ' ...');
      const res = await fetch('/admin/send-to-whitelist', {
        method:'POST',
        headers:{ 'Content-Type':'application/json','x-admin-secret': 'REPLACE_WITH_ADMIN_SECRET_ON_SERVER' },
        body: JSON.stringify({ phone, message: msg })
      });
      const j = await res.json();
      log('Response: ' + JSON.stringify(j));
      if(j.ok) alert('Request processed — check log');
    }catch(e){ log('Error: ' + e.message); alert('Network error'); }
  });
</script>
</body>
      </html>
